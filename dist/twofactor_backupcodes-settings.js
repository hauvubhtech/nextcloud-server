/*! For license information please see twofactor_backupcodes-settings.js.LICENSE.txt */
!function(){"use strict";var e,n={68838:function(e,n,r){var o=r(16453),a=r(20144),s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[t.enabled?[n("p",[t.haveCodes?[t._v("\n\t\t\t\t"+t._s(t.t("twofactor_backupcodes","These are your backup codes. Please save and/or print them as you will not be able to read the codes again later"))+"\n\t\t\t\t"),n("ul",t._l(t.codes,(function(e){return n("li",{key:e,staticClass:"backup-code"},[t._v("\n\t\t\t\t\t\t"+t._s(e)+"\n\t\t\t\t\t")])})),0),t._v(" "),n("a",{staticClass:"button primary",attrs:{href:t.downloadUrl,download:t.downloadFilename}},[t._v(t._s(t.t("twofactor_backupcodes","Save backup codes")))]),t._v(" "),n("button",{staticClass:"button",on:{click:t.printCodes}},[t._v("\n\t\t\t\t\t"+t._s(t.t("twofactor_backupcodes","Print backup codes"))+"\n\t\t\t\t")])]:[t._v("\n\t\t\t\t"+t._s(t.t("twofactor_backupcodes","Backup codes have been generated. {used} of {total} codes have been used.",{used:t.used,total:t.total}))+"\n\t\t\t")]],2),t._v(" "),n("p",[n("button",{attrs:{id:"generate-backup-codes"},on:{click:t.generateBackupCodes}},[t._v("\n\t\t\t\t"+t._s(t.t("twofactor_backupcodes","Regenerate backup codes"))+"\n\t\t\t")])]),t._v(" "),n("p",[n("em",[t._v("\n\t\t\t\t"+t._s(t.t("twofactor_backupcodes","If you regenerate backup codes, you automatically invalidate old codes."))+"\n\t\t\t")])])]:n("button",{attrs:{id:"generate-backup-codes",disabled:t.generatingCodes},on:{click:t.generateBackupCodes}},[t._v("\n\t\t"+t._s(t.t("twofactor_backupcodes","Generate backup codes"))+"\n\t\t"),n("span",{class:{"icon-loading-small":t.generatingCodes}})])],2)};s._withStripped=!0;var c=r(10128);r(65509);var d={name:"PersonalSettings",data:function(){return{generatingCodes:!1}},computed:{downloadUrl:function(){return this.codes?"data:text/plain,"+encodeURIComponent(this.codes.reduce((function(t,e){return t+e+"\r\n"}),"")):""},downloadFilename:function(){return(OC.theme.name||"xD Drive")+"-backup-codes.txt"},enabled:function(){return this.$store.state.enabled},total:function(){return this.$store.state.total},used:function(){return this.$store.state.used},codes:function(){return this.$store.state.codes},name:function(){return OC.theme.name||"xD Drive"},haveCodes:function(){return this.codes&&this.codes.length>0}},methods:{generateBackupCodes:function(){var e=this;(0,c.confirmPassword)().then((function(){e.generatingCodes=!0,e.$store.dispatch("generate").then((function(t){e.generatingCodes=!1})).catch((function(n){throw OC.Notification.showTemporary(t("twofactor_backupcodes","An error occurred while generating your backup codes")),e.generatingCodes=!1,n}))})).catch(console.error.bind(this))},getPrintData:function(t){return t?t.reduce((function(t,e){return t+e+"<br>"}),""):""},printCodes:function(){var e,n,r;e=this.getPrintData(this.codes),n=OC.theme.name||"xD Drive",(r=window.open("",t("twofactor_backupcodes","{name} backup codes",{name:n}))).document.write("<h1>"+t("twofactor_backupcodes","{name} backup codes",{name:n})+"</h1>"),r.document.write("<pre>"+e+"</pre>"),r.print(),r.close()}}},i=r(93379),u=r.n(i),l=r(7795),p=r.n(l),f=r(90569),b=r.n(f),h=r(3565),m=r.n(h),v=r(19216),g=r.n(v),k=r(44589),w=r.n(k),C=r(6070),_={};_.styleTagTransform=w(),_.setAttributes=m(),_.insert=b().bind(null,"head"),_.domAPI=p(),_.insertStyleElement=g(),u()(C.Z,_),C.Z&&C.Z.locals&&C.Z.locals;var y=(0,r(51900).Z)(d,s,[],!1,null,"fdbc4006",null);y.options.__file="apps/twofactor_backupcodes/src/views/PersonalSettings.vue";var A=y.exports,P=r(20629),x=r(4820),O=r(79753);a.ZP.use(P.ZP);var S={setEnabled:function(t,e){a.ZP.set(t,"enabled",e)},setTotal:function(t,e){a.ZP.set(t,"total",e)},setUsed:function(t,e){a.ZP.set(t,"used",e)},setCodes:function(t,e){a.ZP.set(t,"codes",e)}},D={generate:function(t){var e,n=t.commit;return n("setEnabled",!1),(e=(0,O.generateUrl)("/apps/twofactor_backupcodes/settings/create"),x.default.post(e,{}).then((function(t){return t.data}))).then((function(t){var e=t.codes,r=t.state;return n("setEnabled",r.enabled),n("setTotal",r.total),n("setUsed",r.used),n("setCodes",e),!0}))}},Z=new P.yh({strict:!1,state:{enabled:!1,total:0,used:0,codes:[]},mutations:S,actions:D});a.ZP.prototype.t=t;var B=(0,o.loadState)("twofactor_backupcodes","state");Z.replaceState(B),new(a.ZP.extend(A))({store:Z}).$mount("#twofactor-backupcodes-settings")},6070:function(t,e,n){var r=n(87537),o=n.n(r),a=n(23645),s=n.n(a)()(o());s.push([t.id,"\n.backup-code[data-v-fdbc4006] {\n\tfont-family: monospace;\n\tletter-spacing: 0.02em;\n\tfont-size: 1.2em;\n}\n.button[data-v-fdbc4006] {\n\tdisplay: inline-block;\n}\n","",{version:3,sources:["webpack://./apps/twofactor_backupcodes/src/views/PersonalSettings.vue"],names:[],mappings:";AA0HA;CACA,sBAAA;CACA,sBAAA;CACA,gBAAA;AACA;AACA;CACA,qBAAA;AACA",sourcesContent:["<template>\r\n\t<div>\r\n\t\t<button v-if=\"!enabled\"\r\n\t\t\tid=\"generate-backup-codes\"\r\n\t\t\t:disabled=\"generatingCodes\"\r\n\t\t\t@click=\"generateBackupCodes\">\r\n\t\t\t{{ t('twofactor_backupcodes', 'Generate backup codes') }}\r\n\t\t\t<span :class=\"{'icon-loading-small': generatingCodes}\" />\r\n\t\t</button>\r\n\t\t<template v-else>\r\n\t\t\t<p>\r\n\t\t\t\t<template v-if=\"!haveCodes\">\r\n\t\t\t\t\t{{ t('twofactor_backupcodes', 'Backup codes have been generated. {used} of {total} codes have been used.', {used, total}) }}\r\n\t\t\t\t</template>\r\n\t\t\t\t<template v-else>\r\n\t\t\t\t\t{{ t('twofactor_backupcodes', 'These are your backup codes. Please save and/or print them as you will not be able to read the codes again later') }}\r\n\t\t\t\t\t<ul>\r\n\t\t\t\t\t\t<li v-for=\"code in codes\" :key=\"code\" class=\"backup-code\">\r\n\t\t\t\t\t\t\t{{ code }}\r\n\t\t\t\t\t\t</li>\r\n\t\t\t\t\t</ul>\r\n\t\t\t\t\t<a :href=\"downloadUrl\"\r\n\t\t\t\t\t\tclass=\"button primary\"\r\n\t\t\t\t\t\t:download=\"downloadFilename\">{{ t('twofactor_backupcodes', 'Save backup codes') }}</a>\r\n\t\t\t\t\t<button class=\"button\"\r\n\t\t\t\t\t\t@click=\"printCodes\">\r\n\t\t\t\t\t\t{{ t('twofactor_backupcodes', 'Print backup codes') }}\r\n\t\t\t\t\t</button>\r\n\t\t\t\t</template>\r\n\t\t\t</p>\r\n\t\t\t<p>\r\n\t\t\t\t<button id=\"generate-backup-codes\"\r\n\t\t\t\t\t@click=\"generateBackupCodes\">\r\n\t\t\t\t\t{{ t('twofactor_backupcodes', 'Regenerate backup codes') }}\r\n\t\t\t\t</button>\r\n\t\t\t</p>\r\n\t\t\t<p>\r\n\t\t\t\t<em>\r\n\t\t\t\t\t{{ t('twofactor_backupcodes', 'If you regenerate backup codes, you automatically invalidate old codes.') }}\r\n\t\t\t\t</em>\r\n\t\t\t</p>\r\n\t\t</template>\r\n\t</div>\r\n</template>\r\n\r\n<script>\r\nimport { confirmPassword } from '@nextcloud/password-confirmation'\r\nimport '@nextcloud/password-confirmation/dist/style.css'\r\nimport { print } from '../service/PrintService'\r\n\r\nexport default {\r\n\tname: 'PersonalSettings',\r\n\tdata() {\r\n\t\treturn {\r\n\t\t\tgeneratingCodes: false,\r\n\t\t}\r\n\t},\r\n\tcomputed: {\r\n\t\tdownloadUrl() {\r\n\t\t\tif (!this.codes) {\r\n\t\t\t\treturn ''\r\n\t\t\t}\r\n\t\t\treturn 'data:text/plain,' + encodeURIComponent(this.codes.reduce((prev, code) => {\r\n\t\t\t\treturn prev + code + '\\r\\n'\r\n\t\t\t}, ''))\r\n\t\t},\r\n\t\tdownloadFilename() {\r\n\t\t\tconst name = OC.theme.name || 'xD Drive'\r\n\t\t\treturn name + '-backup-codes.txt'\r\n\t\t},\r\n\t\tenabled() {\r\n\t\t\treturn this.$store.state.enabled\r\n\t\t},\r\n\t\ttotal() {\r\n\t\t\treturn this.$store.state.total\r\n\t\t},\r\n\t\tused() {\r\n\t\t\treturn this.$store.state.used\r\n\t\t},\r\n\t\tcodes() {\r\n\t\t\treturn this.$store.state.codes\r\n\t\t},\r\n\t\tname() {\r\n\t\t\treturn OC.theme.name || 'xD Drive'\r\n\t\t},\r\n\t\thaveCodes() {\r\n\t\t\treturn this.codes && this.codes.length > 0\r\n\t\t},\r\n\t},\r\n\tmethods: {\r\n\t\tgenerateBackupCodes() {\r\n\t\t\tconfirmPassword().then(() => {\r\n\t\t\t\t// Hide old codes\r\n\t\t\t\tthis.generatingCodes = true\r\n\r\n\t\t\t\tthis.$store.dispatch('generate').then(data => {\r\n\t\t\t\t\tthis.generatingCodes = false\r\n\t\t\t\t}).catch(err => {\r\n\t\t\t\t\tOC.Notification.showTemporary(t('twofactor_backupcodes', 'An error occurred while generating your backup codes'))\r\n\t\t\t\t\tthis.generatingCodes = false\r\n\t\t\t\t\tthrow err\r\n\t\t\t\t})\r\n\t\t\t}).catch(console.error.bind(this))\r\n\t\t},\r\n\r\n\t\tgetPrintData(codes) {\r\n\t\t\tif (!codes) {\r\n\t\t\t\treturn ''\r\n\t\t\t}\r\n\t\t\treturn codes.reduce((prev, code) => {\r\n\t\t\t\treturn prev + code + '<br>'\r\n\t\t\t}, '')\r\n\t\t},\r\n\r\n\t\tprintCodes() {\r\n\t\t\tprint(this.getPrintData(this.codes))\r\n\t\t},\r\n\t},\r\n}\r\n<\/script>\r\n\r\n<style scoped>\r\n\t.backup-code {\r\n\t\tfont-family: monospace;\r\n\t\tletter-spacing: 0.02em;\r\n\t\tfont-size: 1.2em;\r\n\t}\r\n\t.button {\r\n\t\tdisplay: inline-block;\r\n\t}\r\n</style>\r\n"],sourceRoot:""}]),e.Z=s}},r={};function o(t){var e=r[t];if(void 0!==e)return e.exports;var a=r[t]={id:t,loaded:!1,exports:{}};return n[t].call(a.exports,a,a.exports,o),a.loaded=!0,a.exports}o.m=n,o.amdD=function(){throw new Error("define cannot be used indirect")},o.amdO={},e=[],o.O=function(t,n,r,a){if(!n){var s=1/0;for(u=0;u<e.length;u++){n=e[u][0],r=e[u][1],a=e[u][2];for(var c=!0,d=0;d<n.length;d++)(!1&a||s>=a)&&Object.keys(o.O).every((function(t){return o.O[t](n[d])}))?n.splice(d--,1):(c=!1,a<s&&(s=a));if(c){e.splice(u--,1);var i=r();void 0!==i&&(t=i)}}return t}a=a||0;for(var u=e.length;u>0&&e[u-1][2]>a;u--)e[u]=e[u-1];e[u]=[n,r,a]},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,{a:e}),e},o.d=function(t,e){for(var n in e)o.o(e,n)&&!o.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},o.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.nmd=function(t){return t.paths=[],t.children||(t.children=[]),t},o.j=2870,function(){o.b=document.baseURI||self.location.href;var t={2870:0};o.O.j=function(e){return 0===t[e]};var e=function(e,n){var r,a,s=n[0],c=n[1],d=n[2],i=0;if(s.some((function(e){return 0!==t[e]}))){for(r in c)o.o(c,r)&&(o.m[r]=c[r]);if(d)var u=d(o)}for(e&&e(n);i<s.length;i++)a=s[i],o.o(t,a)&&t[a]&&t[a][0](),t[a]=0;return o.O(u)},n=self.webpackChunknextcloud=self.webpackChunknextcloud||[];n.forEach(e.bind(null,0)),n.push=e.bind(null,n.push.bind(n))}(),o.nc=void 0;var a=o.O(void 0,[7874],(function(){return o(68838)}));a=o.O(a)}();
//# sourceMappingURL=twofactor_backupcodes-settings.js.map?v=43d514d311559565b369