/*! For license information please see files_versions-files_versions.js.LICENSE.txt */
!function(){var e,i={22420:function(e,i,r){"use strict";r(29088),r(47673);var o=r(94702),l=r.n(o),s=r(97834),a=r.n(s);!function(){if(OCA.Files.DetailTabView){var e=OCA.Files.DetailTabView.extend({id:"versionsTabView",className:"tab versionsTabView",_template:null,$versionsContainer:null,events:{"click .revertVersion":"_onClickRevertVersion"},initialize:function(){OCA.Files.DetailTabView.prototype.initialize.apply(this,arguments),this.collection=new OCA.Versions.VersionCollection,this.collection.on("request",this._onRequest,this),this.collection.on("sync",this._onEndRequest,this),this.collection.on("update",this._onUpdate,this),this.collection.on("error",this._onError,this),this.collection.on("add",this._onAddModel,this)},getLabel:function(){return t("files_versions","Versions")},getIcon:function(){return"icon-history"},nextPage:function(){this._loading||this.collection.getFileInfo()&&this.collection.getFileInfo().isDirectory()||this.collection.fetch()},_onClickRevertVersion:function(e){var n=this,i=$(e.target),r=this.collection.getFileInfo();i.is("li")||(i=i.closest("li")),e.preventDefault();var o=i.attr("data-revision"),l=this.collection.get(o);l.revert({success:function(){n.$versionsContainer.empty(),n.collection.setFileInfo(r),n.collection.reset([],{silent:!0}),n.collection.fetch(),n.$el.find(".versions").removeClass("hidden"),r.trigger("busy",r,!1),r.set({size:l.get("size"),mtime:1e3*l.get("timestamp"),etag:l.get("id")+l.get("timestamp")})},error:function(){r.trigger("busy",r,!1),n.$el.find(".versions").removeClass("hidden"),n._toggleLoading(!1),OC.Notification.show(t("files_version","Failed to revert {file} to revision {timestamp}.",{file:l.getFullPath(),timestamp:OC.Util.formatDate(1e3*l.get("timestamp"))}),{type:"error"})}}),this._toggleLoading(!0),r.trigger("busy",r,!0)},_toggleLoading:function(e){this._loading=e,this.$el.find(".loading").toggleClass("hidden",!e)},_onRequest:function(){this._toggleLoading(!0)},_onEndRequest:function(){this._toggleLoading(!1),this.$el.find(".empty").toggleClass("hidden",!!this.collection.length)},_onAddModel:function(e){var n=$(this.itemTemplate(this._formatItem(e)));this.$versionsContainer.append(n),n.find(".has-tooltip").tooltip()},template:function(e){return a()(e)},itemTemplate:function(e){return l()(e)},setFileInfo:function(e){e?(this.render(),this.collection.setFileInfo(e),this.collection.reset([],{silent:!0}),this.nextPage()):(this.render(),this.collection.reset())},_formatItem:function(e){var i=1e3*e.get("timestamp"),r=e.has("size")?e.get("size"):0,o=OC.MimeType.getIconUrl(e.get("mimetype")),l=new Image;return l.onload=function(){$("li[data-revision="+e.get("id")+"] .preview").attr("src",e.getPreviewUrl())},l.src=e.getPreviewUrl(),_.extend({versionId:e.get("id"),formattedTimestamp:OC.Util.formatDate(i),relativeTimestamp:OC.Util.relativeModifiedDate(i),millisecondsTimestamp:i,humanReadableSize:OC.Util.humanFileSize(r,!0),altSize:n("files","%n byte","%n bytes",r),hasDetails:e.has("size"),downloadUrl:e.getDownloadUrl(),downloadIconUrl:OC.imagePath("core","actions/download"),downloadName:e.get("name"),revertIconUrl:OC.imagePath("core","actions/history"),previewUrl:o,revertLabel:t("files_versions","Restore"),canRevert:0!=(this.collection.getFileInfo().get("permissions")&OC.PERMISSION_UPDATE)},e.attributes)},render:function(){this.$el.html(this.template({emptyResultLabel:t("files_versions","No other versions available")})),this.$el.find(".has-tooltip").tooltip(),this.$versionsContainer=this.$el.find("ul.versions"),this.delegateEvents()},canDisplay:function(e){return!!e&&!e.isDirectory()}});OCA.Versions=OCA.Versions||{},OCA.Versions.VersionsTabView=e}}(),r(29020);var c=r(93379),u=r.n(c),d=r(7795),p=r.n(d),m=r(90569),v=r.n(m),h=r(3565),f=r.n(h),A=r(19216),g=r.n(A),C=r(44589),b=r.n(C),w=r(42028),y={};y.styleTagTransform=b(),y.setAttributes=f(),y.insert=v().bind(null,"head"),y.domAPI=p(),y.insertStyleElement=g(),u()(w.Z,y),w.Z&&w.Z.locals&&w.Z.locals,window.OCA.Versions=OCA.Versions},29020:function(){OCA.Versions=OCA.Versions||{},OCA.Versions.Util={attach:function(e){"trashbin"!==e.id&&"files.public"!==e.id&&e.registerTabView(new OCA.Versions.VersionsTabView("versionsTabView",{order:-10}))}},OC.Plugins.register("OCA.Files.FileList",OCA.Versions.Util)},47673:function(){var e;e=OC.Backbone.Collection.extend({model:OCA.Versions.VersionModel,sync:OC.Backbone.davSync,_fileInfo:null,_currentUser:null,_client:null,setFileInfo:function(e){this._fileInfo=e},getFileInfo:function(){return this._fileInfo},setCurrentUser:function(e){this._currentUser=e},getCurrentUser:function(){return this._currentUser||OC.getCurrentUser().uid},setClient:function(e){this._client=e},getClient:function(){return this._client||new OC.Files.Client({host:OC.getHost(),root:OC.linkToRemoteBase("dav")+"/versions/"+this.getCurrentUser(),useHTTPS:"https"===OC.getProtocol()})},url:function(){return OC.linkToRemoteBase("dav")+"/versions/"+this.getCurrentUser()+"/versions/"+this._fileInfo.get("id")},parse:function(e){var n=this._fileInfo.getFullPath(),t=this._fileInfo.get("id"),i=this._fileInfo.get("name"),r=this.getCurrentUser(),o=this.getClient();return _.map(e,(function(e){return e.fullPath=n,e.fileId=t,e.name=i,e.timestamp=parseInt(moment(new Date(e.timestamp)).format("X"),10),e.id=OC.basename(e.href),e.size=parseInt(e.size,10),e.user=r,e.client=o,e}))}}),OCA.Versions=OCA.Versions||{},OCA.Versions.VersionCollection=e},29088:function(){var e;e=OC.Backbone.Model.extend({sync:OC.Backbone.davSync,davProperties:{size:"{DAV:}getcontentlength",mimetype:"{DAV:}getcontenttype",timestamp:"{DAV:}getlastmodified"},revert:function(e){e=e?_.clone(e):{};var n=this;return this.get("client").move("/versions/"+this.get("fileId")+"/"+this.get("id"),"/restore/target",!0).done((function(){e.success&&e.success.call(e.context,n,{},e),n.trigger("revert",n,e)})).fail((function(){e.error&&e.error.call(e.context,n,{},e),n.trigger("error",n,{},e)}))},getFullPath:function(){return this.get("fullPath")},getPreviewUrl:function(){var e=OC.generateUrl("/apps/files_versions/preview"),n={file:this.get("fullPath"),version:this.get("id")};return e+"?"+OC.buildQueryString(n)},getDownloadUrl:function(){return OC.linkToRemoteBase("dav")+"/versions/"+this.get("user")+"/versions/"+this.get("fileId")+"/"+this.get("id")}}),OCA.Versions=OCA.Versions||{},OCA.Versions.VersionModel=e},42028:function(e,n,t){"use strict";var i=t(87537),r=t.n(i),o=t(23645),l=t.n(o)()(r());l.push([e.id,".versionsTabView .clear-float {\r\n\tclear: both;\r\n}\r\n\r\n.versionsTabView li {\r\n\twidth: 100%;\r\n\tcursor: default;\r\n\theight: 56px;\r\n\tfloat: left;\r\n\tborder-bottom: 1px solid rgba(100,100,100,.1);\r\n}\r\n.versionsTabView li:last-child {\r\n\tborder-bottom: none;\r\n}\r\n\r\n.versionsTabView a,\r\n.versionsTabView div > span {\r\n\tvertical-align: middle;\r\n\topacity: .5;\r\n}\r\n\r\n.versionsTabView li a{\r\n\tpadding: 15px 10px 11px;\r\n}\r\n\r\n.versionsTabView a:hover,\r\n.versionsTabView a:focus {\r\n\topacity: 1;\r\n}\r\n\r\n.versionsTabView .preview-container {\r\n\tdisplay: inline-block;\r\n  vertical-align: top;\r\n}\r\n\r\n.versionsTabView .version-container img, .revertVersion img {\r\n\tfilter: var(--background-invert-if-dark);\r\n}\r\n\r\n.versionsTabView img {\r\n\tcursor: pointer;\r\n\tpadding-right: 4px;\r\n}\r\n\r\n.versionsTabView img.preview {\r\n\tcursor: default;\r\n}\r\n\r\n.versionsTabView .version-container {\r\n\tdisplay: inline-block;\r\n}\r\n\r\n.versionsTabView .versiondate {\r\n\tmin-width: 100px;\r\n\tvertical-align: super;\r\n}\r\n\r\n.versionsTabView .version-details {\r\n\ttext-align: left;\r\n}\r\n\r\n.versionsTabView .version-details > span {\r\n\tpadding: 0 10px;\r\n}\r\n\r\n.versionsTabView .revertVersion {\r\n\tcursor: pointer;\r\n\tfloat: right;\r\n\tmargin-right: -10px;\r\n}\r\n\r\n.versionsTabView .emptycontent {\r\n\tmargin-top: 50px !important;\r\n}\r\n","",{version:3,sources:["webpack://./apps/files_versions/src/css/versions.css"],names:[],mappings:"AAAA;CACC,WAAW;AACZ;;AAEA;CACC,WAAW;CACX,eAAe;CACf,YAAY;CACZ,WAAW;CACX,6CAA6C;AAC9C;AACA;CACC,mBAAmB;AACpB;;AAEA;;CAEC,sBAAsB;CACtB,WAAW;AACZ;;AAEA;CACC,uBAAuB;AACxB;;AAEA;;CAEC,UAAU;AACX;;AAEA;CACC,qBAAqB;EACpB,mBAAmB;AACrB;;AAEA;CACC,wCAAwC;AACzC;;AAEA;CACC,eAAe;CACf,kBAAkB;AACnB;;AAEA;CACC,eAAe;AAChB;;AAEA;CACC,qBAAqB;AACtB;;AAEA;CACC,gBAAgB;CAChB,qBAAqB;AACtB;;AAEA;CACC,gBAAgB;AACjB;;AAEA;CACC,eAAe;AAChB;;AAEA;CACC,eAAe;CACf,YAAY;CACZ,mBAAmB;AACpB;;AAEA;CACC,2BAA2B;AAC5B",sourcesContent:[".versionsTabView .clear-float {\r\n\tclear: both;\r\n}\r\n\r\n.versionsTabView li {\r\n\twidth: 100%;\r\n\tcursor: default;\r\n\theight: 56px;\r\n\tfloat: left;\r\n\tborder-bottom: 1px solid rgba(100,100,100,.1);\r\n}\r\n.versionsTabView li:last-child {\r\n\tborder-bottom: none;\r\n}\r\n\r\n.versionsTabView a,\r\n.versionsTabView div > span {\r\n\tvertical-align: middle;\r\n\topacity: .5;\r\n}\r\n\r\n.versionsTabView li a{\r\n\tpadding: 15px 10px 11px;\r\n}\r\n\r\n.versionsTabView a:hover,\r\n.versionsTabView a:focus {\r\n\topacity: 1;\r\n}\r\n\r\n.versionsTabView .preview-container {\r\n\tdisplay: inline-block;\r\n  vertical-align: top;\r\n}\r\n\r\n.versionsTabView .version-container img, .revertVersion img {\r\n\tfilter: var(--background-invert-if-dark);\r\n}\r\n\r\n.versionsTabView img {\r\n\tcursor: pointer;\r\n\tpadding-right: 4px;\r\n}\r\n\r\n.versionsTabView img.preview {\r\n\tcursor: default;\r\n}\r\n\r\n.versionsTabView .version-container {\r\n\tdisplay: inline-block;\r\n}\r\n\r\n.versionsTabView .versiondate {\r\n\tmin-width: 100px;\r\n\tvertical-align: super;\r\n}\r\n\r\n.versionsTabView .version-details {\r\n\ttext-align: left;\r\n}\r\n\r\n.versionsTabView .version-details > span {\r\n\tpadding: 0 10px;\r\n}\r\n\r\n.versionsTabView .revertVersion {\r\n\tcursor: pointer;\r\n\tfloat: right;\r\n\tmargin-right: -10px;\r\n}\r\n\r\n.versionsTabView .emptycontent {\r\n\tmargin-top: 50px !important;\r\n}\r\n"],sourceRoot:""}]),n.Z=l},94702:function(e,n,t){var i=t(40202);e.exports=(i.default||i).template({1:function(e,n,t,i,r){var o,l=null!=n?n:e.nullContext||{},s=e.hooks.helperMissing,a="function",c=e.escapeExpression,u=e.lookupProperty||function(e,n){if(Object.prototype.hasOwnProperty.call(e,n))return e[n]};return'\t\t\t\t<div class="version-details">\r\n\t\t\t\t\t<span class="size has-tooltip" title="'+c(typeof(o=null!=(o=u(t,"altSize")||(null!=n?u(n,"altSize"):n))?o:s)===a?o.call(l,{name:"altSize",hash:{},data:r,loc:{start:{line:14,column:43},end:{line:14,column:54}}}):o)+'">'+c(typeof(o=null!=(o=u(t,"humanReadableSize")||(null!=n?u(n,"humanReadableSize"):n))?o:s)===a?o.call(l,{name:"humanReadableSize",hash:{},data:r,loc:{start:{line:14,column:56},end:{line:14,column:77}}}):o)+"</span>\r\n\t\t\t\t</div>\r\n"},3:function(e,n,t,i,r){var o,l=null!=n?n:e.nullContext||{},s=e.hooks.helperMissing,a="function",c=e.escapeExpression,u=e.lookupProperty||function(e,n){if(Object.prototype.hasOwnProperty.call(e,n))return e[n]};return'\t\t\t<a href="#" class="revertVersion" title="'+c(typeof(o=null!=(o=u(t,"revertLabel")||(null!=n?u(n,"revertLabel"):n))?o:s)===a?o.call(l,{name:"revertLabel",hash:{},data:r,loc:{start:{line:19,column:44},end:{line:19,column:59}}}):o)+'"><img src="'+c(typeof(o=null!=(o=u(t,"revertIconUrl")||(null!=n?u(n,"revertIconUrl"):n))?o:s)===a?o.call(l,{name:"revertIconUrl",hash:{},data:r,loc:{start:{line:19,column:71},end:{line:19,column:88}}}):o)+'" /></a>\r\n'},compiler:[8,">= 4.3.0"],main:function(e,n,t,i,r){var o,l,s,a=null!=n?n:e.nullContext||{},c=e.hooks.helperMissing,u="function",d=e.escapeExpression,p=e.hooks.blockHelperMissing,m=e.lookupProperty||function(e,n){if(Object.prototype.hasOwnProperty.call(e,n))return e[n]},v='<li data-revision="'+d(typeof(l=null!=(l=m(t,"id")||(null!=n?m(n,"id"):n))?l:c)===u?l.call(a,{name:"id",hash:{},data:r,loc:{start:{line:1,column:19},end:{line:1,column:25}}}):l)+'">\r\n\t<div>\r\n\t\t<div class="preview-container">\r\n\t\t\t<img class="preview" src="'+d(typeof(l=null!=(l=m(t,"previewUrl")||(null!=n?m(n,"previewUrl"):n))?l:c)===u?l.call(a,{name:"previewUrl",hash:{},data:r,loc:{start:{line:4,column:29},end:{line:4,column:43}}}):l)+'" width="44" height="44"/>\r\n\t\t</div>\r\n\t\t<div class="version-container">\r\n\t\t\t<div>\r\n\t\t\t\t<a href="'+d(typeof(l=null!=(l=m(t,"downloadUrl")||(null!=n?m(n,"downloadUrl"):n))?l:c)===u?l.call(a,{name:"downloadUrl",hash:{},data:r,loc:{start:{line:8,column:13},end:{line:8,column:28}}}):l)+'" class="downloadVersion" download="'+d(typeof(l=null!=(l=m(t,"downloadName")||(null!=n?m(n,"downloadName"):n))?l:c)===u?l.call(a,{name:"downloadName",hash:{},data:r,loc:{start:{line:8,column:64},end:{line:8,column:80}}}):l)+'"><img src="'+d(typeof(l=null!=(l=m(t,"downloadIconUrl")||(null!=n?m(n,"downloadIconUrl"):n))?l:c)===u?l.call(a,{name:"downloadIconUrl",hash:{},data:r,loc:{start:{line:8,column:92},end:{line:8,column:111}}}):l)+'" />\r\n\t\t\t\t\t<span class="versiondate has-tooltip live-relative-timestamp" data-timestamp="'+d(typeof(l=null!=(l=m(t,"millisecondsTimestamp")||(null!=n?m(n,"millisecondsTimestamp"):n))?l:c)===u?l.call(a,{name:"millisecondsTimestamp",hash:{},data:r,loc:{start:{line:9,column:83},end:{line:9,column:108}}}):l)+'" title="'+d(typeof(l=null!=(l=m(t,"formattedTimestamp")||(null!=n?m(n,"formattedTimestamp"):n))?l:c)===u?l.call(a,{name:"formattedTimestamp",hash:{},data:r,loc:{start:{line:9,column:117},end:{line:9,column:139}}}):l)+'">'+d(typeof(l=null!=(l=m(t,"relativeTimestamp")||(null!=n?m(n,"relativeTimestamp"):n))?l:c)===u?l.call(a,{name:"relativeTimestamp",hash:{},data:r,loc:{start:{line:9,column:141},end:{line:9,column:162}}}):l)+"</span>\r\n\t\t\t\t</a>\r\n\t\t\t</div>\r\n";return l=null!=(l=m(t,"hasDetails")||(null!=n?m(n,"hasDetails"):n))?l:c,s={name:"hasDetails",hash:{},fn:e.program(1,r,0),inverse:e.noop,data:r,loc:{start:{line:12,column:3},end:{line:16,column:18}}},o=typeof l===u?l.call(a,s):l,m(t,"hasDetails")||(o=p.call(n,o,s)),null!=o&&(v+=o),v+="\t\t</div>\r\n",l=null!=(l=m(t,"canRevert")||(null!=n?m(n,"canRevert"):n))?l:c,s={name:"canRevert",hash:{},fn:e.program(3,r,0),inverse:e.noop,data:r,loc:{start:{line:18,column:2},end:{line:20,column:16}}},o=typeof l===u?l.call(a,s):l,m(t,"canRevert")||(o=p.call(n,o,s)),null!=o&&(v+=o),v+"\t</div>\r\n</li>\r\n"},useData:!0})},97834:function(e,n,t){var i=t(40202);e.exports=(i.default||i).template({compiler:[8,">= 4.3.0"],main:function(e,n,t,i,r){var o,l=null!=n?n:e.nullContext||{},s=e.hooks.helperMissing,a="function",c=e.escapeExpression,u=e.lookupProperty||function(e,n){if(Object.prototype.hasOwnProperty.call(e,n))return e[n]};return'<ul class="versions"></ul>\r\n<div class="clear-float"></div>\r\n<div class="empty hidden">\r\n\t<div class="emptycontent">\r\n\t\t<div class="icon-history"></div>\r\n\t\t<p>'+c(typeof(o=null!=(o=u(t,"emptyResultLabel")||(null!=n?u(n,"emptyResultLabel"):n))?o:s)===a?o.call(l,{name:"emptyResultLabel",hash:{},data:r,loc:{start:{line:6,column:5},end:{line:6,column:25}}}):o)+'</p>\r\n\t</div>\r\n</div>\r\n<input type="button" class="showMoreVersions hidden" value="'+c(typeof(o=null!=(o=u(t,"moreVersionsLabel")||(null!=n?u(n,"moreVersionsLabel"):n))?o:s)===a?o.call(l,{name:"moreVersionsLabel",hash:{},data:r,loc:{start:{line:9,column:60},end:{line:9,column:81}}}):o)+'" name="show-more-versions" id="show-more-versions" />\r\n<div class="loading hidden" style="height: 50px"></div>\r\n'},useData:!0})}},r={};function o(e){var n=r[e];if(void 0!==n)return n.exports;var t=r[e]={id:e,loaded:!1,exports:{}};return i[e].call(t.exports,t,t.exports,o),t.loaded=!0,t.exports}o.m=i,o.amdD=function(){throw new Error("define cannot be used indirect")},o.amdO={},e=[],o.O=function(n,t,i,r){if(!t){var l=1/0;for(u=0;u<e.length;u++){t=e[u][0],i=e[u][1],r=e[u][2];for(var s=!0,a=0;a<t.length;a++)(!1&r||l>=r)&&Object.keys(o.O).every((function(e){return o.O[e](t[a])}))?t.splice(a--,1):(s=!1,r<l&&(l=r));if(s){e.splice(u--,1);var c=i();void 0!==c&&(n=c)}}return n}r=r||0;for(var u=e.length;u>0&&e[u-1][2]>r;u--)e[u]=e[u-1];e[u]=[t,i,r]},o.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(n,{a:n}),n},o.d=function(e,n){for(var t in n)o.o(n,t)&&!o.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:n[t]})},o.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),o.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.nmd=function(e){return e.paths=[],e.children||(e.children=[]),e},o.j=1358,function(){o.b=document.baseURI||self.location.href;var e={1358:0};o.O.j=function(n){return 0===e[n]};var n=function(n,t){var i,r,l=t[0],s=t[1],a=t[2],c=0;if(l.some((function(n){return 0!==e[n]}))){for(i in s)o.o(s,i)&&(o.m[i]=s[i]);if(a)var u=a(o)}for(n&&n(t);c<l.length;c++)r=l[c],o.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return o.O(u)},t=self.webpackChunknextcloud=self.webpackChunknextcloud||[];t.forEach(n.bind(null,0)),t.push=n.bind(null,t.push.bind(t))}(),o.nc=void 0;var l=o.O(void 0,[7874],(function(){return o(22420)}));l=o.O(l)}();
//# sourceMappingURL=files_versions-files_versions.js.map?v=1c19212ab067f3fbc967